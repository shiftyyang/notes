# 偏向锁



![4](http://blog-shifty.oss-cn-shanghai.aliyuncs.com/uPic/4.png)

* 大多数情况，锁不存在多线程竞争，同一个线程反复获取释放锁，会导致很多不必要的上下文切换，影响性能。

* 当一个线程访问同步块获取锁时，会在对象头和栈帧中的所记录里存储偏向锁的线程ID。

* 以后线程再进入和退出同步块不需要CAS加锁和解锁（只需检查一下对象头的Mark Word是否存储这指向当前线程的偏向锁）。



### **偏向锁撤销**

![5](http://blog-shifty.oss-cn-shanghai.aliyuncs.com/uPic/5.png)

偏向锁使用了一种等待竞争才会释放锁的机制。

其它线程获取偏向锁时，持有偏向锁的线程才会释放锁，且线程处于不活动状态才会释放，将对象头设置为无状态。

如果线程活着，VM会遍历栈帧中的锁记录，栈帧中的锁记录和对象头要么偏向于其它线程，要么恢复到无锁状态或者标记对象不适合作为偏向锁。